import{u as P,a as z,r as o,j as e,P as A,C as c,b as u,c as m,L as D,B as p,T as F,D as B,d as L,m as E,e as M,g as T,f as G,h as V,i as Y,M as H,k as R}from"./index-iislL19E.js";function O(r){return new Date(r).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function W(r){const[j,g]=o.useState(!1),h=o.useMemo(()=>{try{return!!window.localStorage.getItem(r)}catch{return!0}},[r]);return{show:!j&&!h,dismiss:()=>{try{window.localStorage.setItem(r,"1")}catch{}g(!0)}}}function K(){const{state:r}=P(),j=r.schoolConfig.features.reports,g=r.student.checkIns,h=g.length>0,y=r.student.incidents.filter(t=>t.context?.submittedBy==="student"||!t.context?.submittedBy),l=r.schoolConfig.emergencyContact,v=!!(l.title||l.phone||l.email)?e.jsxs(c,{children:[e.jsx(u,{emoji:"â˜Žï¸",title:"Emergency contact",subtitle:"If you need urgent help, contact a trusted adult."}),e.jsxs(m,{className:"space-y-2",children:[l.title?e.jsx("div",{className:"text-sm font-extrabold text-[rgb(var(--nefera-ink))]",children:l.title}):null,l.phone?e.jsxs("div",{className:"text-sm text-[rgb(var(--nefera-muted))]",children:["Phone:"," ",e.jsx("a",{className:"font-semibold text-[rgb(var(--nefera-brand))]",href:`tel:${l.phone}`,children:l.phone})]}):null,l.email?e.jsxs("div",{className:"text-sm text-[rgb(var(--nefera-muted))]",children:["Email:"," ",e.jsx("a",{className:"font-semibold text-[rgb(var(--nefera-brand))]",href:`mailto:${l.email}`,children:l.email})]}):null]})]}):null,f=o.useMemo(()=>{const t=new Date(T()),s=[];for(let a=0;a<7;a++){const n=new Date(t);n.setDate(n.getDate()-a),s.push(n.toISOString().slice(0,10))}return s},[]),N=o.useMemo(()=>{const t=new Date(T()),s=[];for(let a=0;a<30;a++){const n=new Date(t);n.setDate(n.getDate()-a),s.push(n.toISOString().slice(0,10))}return s.reverse()},[]),x=o.useMemo(()=>{const t=new Map;for(const s of g){const a=s.createdAt.slice(0,10),n=t.get(a);(!n||n.createdAt<s.createdAt)&&t.set(a,s)}return t},[g]),b=o.useMemo(()=>{const t={happy:0,neutral:0,flat:0,worried:0,sad:0};for(const s of f){const a=x.get(s);a&&t[a.feeling]++}return["happy","neutral","flat","worried","sad"].map(s=>({label:G(s),value:t[s],color:`rgb(var(--nefera-feeling-${s}))`}))},[x,f]),I=o.useMemo(()=>{const t={happy:4,neutral:3,flat:2,worried:2,sad:1},s={lastValue:2.6,values:[]};return N.reduce((a,n)=>{const i=x.get(n),C=i?t[i.feeling]:a.lastValue;return{lastValue:C,values:[...a.values,C]}},s).values},[x,N]),k=o.useMemo(()=>{const t={};function s(n){t[n]=(t[n]??0)+1}function a(n){const i=n.toLowerCase();return/(exam|test|homework|assignment|deadline|grade|school work|schoolwork|stud)/.test(i)?"Studies":/(sleep|tired|energy|bed|wake)/.test(i)?"Sleep issues":/(friend|social|classmate|left out|alone|group)/.test(i)?"Social concerns":/(screen|phone|social media|media|tv)/.test(i)?"Screen time & Comparison":/(family|mom|dad|parent|guardian|home)/.test(i)?"Family-related Concerns":"Other"}for(const n of f){const i=x.get(n);if(!i)continue;for(const _ of(i.answers.mainSelections??[]).filter(Boolean))s(a(String(_)));const C=String(i.answers.mainSelectionsOther??"").trim();C&&s(a(C)),typeof i.answers.flatSleepLastNight=="string"&&s(a(i.answers.flatSleepLastNight)),typeof i.answers.worriedMadeHard=="string"&&s(a(i.answers.worriedMadeHard)),typeof i.answers.sadHardToEnjoy=="string"&&s(a(i.answers.sadHardToEnjoy))}return Object.entries(t).sort((n,i)=>i[1]-n[1]).slice(0,5).map(([n,i])=>({label:n,value:i}))},[x,f]),w=Math.max(1,...k.map(t=>t.value)),d=o.useMemo(()=>{const t={positive:0,neutral:0,stressed:0,down:0};for(const n of f){const i=x.get(n);i&&(i.feeling==="happy"?t.positive++:i.feeling==="neutral"?t.neutral++:i.feeling==="worried"?t.stressed++:t.down++)}const s=t.positive+t.neutral+t.stressed+t.down;return{...t,total:s,pct:n=>s?Math.round(n/s*100):0}},[x,f]);return e.jsx(A,{emoji:"ðŸ“Š",title:"Activity reports",subtitle:"A calm view of patterns â€” not judgement.",children:j?e.jsxs(e.Fragment,{children:[h?null:e.jsxs(c,{className:"mb-4",children:[e.jsx(u,{emoji:"ðŸŒ±",title:"No report data yet",subtitle:"Start with a quick check-in. Weâ€™ll build patterns over time."}),e.jsxs(m,{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("div",{className:"text-sm leading-6 text-[rgb(var(--nefera-muted))]",children:"Once you do a few check-ins, youâ€™ll see trends here. One minute a day is enough."}),e.jsx(D,{to:"/student/check-in",children:e.jsx(p,{children:"Do a check-in"})})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(c,{className:"transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-xl active:translate-y-0",children:[e.jsx(u,{emoji:"ðŸ©",title:"Weekly feeling distribution",subtitle:"Last 7 days."}),e.jsx(m,{children:h?e.jsxs("div",{className:"grid gap-5 md:grid-cols-2 md:items-center",children:[e.jsx("div",{className:"grid place-items-center rounded-2xl border border-white/70 bg-white/55 p-6 shadow-lg shadow-black/5",children:e.jsx(V,{size:176,stroke:18,segments:b})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Y,{segments:b}),e.jsx("div",{className:"rounded-2xl border border-white/70 bg-white/55 p-4 text-sm text-[rgb(var(--nefera-muted))] shadow-lg shadow-black/5",children:e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-[rgb(var(--nefera-ink))]",children:"Positive days"}),e.jsxs("span",{children:[d.positive," days (",d.pct(d.positive),"%)"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-[rgb(var(--nefera-ink))]",children:"Neutral days"}),e.jsxs("span",{children:[d.neutral," days (",d.pct(d.neutral),"%)"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-[rgb(var(--nefera-ink))]",children:"Stressed days"}),e.jsxs("span",{children:[d.stressed," days (",d.pct(d.stressed),"%)"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-[rgb(var(--nefera-ink))]",children:"Down days"}),e.jsxs("span",{children:[d.down," days (",d.pct(d.down),"%)"]})]})]})}),e.jsx("div",{className:"grid gap-3",children:b.map(t=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm font-semibold text-[rgb(var(--nefera-muted))]",children:[e.jsxs("span",{className:"flex items-center gap-2 text-[rgb(var(--nefera-ink))]",children:[e.jsx("span",{className:"h-2.5 w-2.5 rounded-full",style:{background:t.color}}),t.label]}),e.jsx("span",{children:t.value})]}),e.jsx(H,{value:t.value,max:Math.max(...b.map(s=>s.value)),color:t.color})]},t.label))})]})]}):e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-48 rounded-2xl border border-white/70 bg-white/55"}),e.jsx("div",{className:"h-4 w-44 rounded-full bg-black/10"}),e.jsx("div",{className:"h-4 w-64 rounded-full bg-black/10"})]})})]}),e.jsxs(c,{className:"transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-xl active:translate-y-0",children:[e.jsx(u,{emoji:"ðŸ“ˆ",title:"Monthly feeling trends",subtitle:"How your days have been trending."}),e.jsx(m,{children:h?e.jsxs(e.Fragment,{children:[e.jsx(R,{values:I,width:520,height:160,className:"w-full"}),e.jsx("div",{className:"mt-4 rounded-2xl border border-white/70 bg-white/55 p-4 text-sm leading-6 text-[rgb(var(--nefera-muted))] shadow-lg shadow-black/5",children:"Higher line = more energy and ease."})]}):e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-40 w-full rounded-2xl border border-white/70 bg-white/55"}),e.jsx("div",{className:"h-4 w-64 rounded-full bg-black/10"})]})})]}),e.jsxs(c,{className:"md:col-span-2 transition-all duration-200 ease-out hover:-translate-y-0.5 hover:shadow-xl active:translate-y-0",children:[e.jsx(u,{emoji:"ðŸ§ ",title:"Top stressors",subtitle:"What shows up most often."}),e.jsx(m,{className:"grid gap-3 md:grid-cols-2",children:h?k.length?k.map(t=>e.jsxs("div",{className:"rounded-2xl border border-white/70 bg-white/55 p-6 shadow-lg shadow-black/5",children:[e.jsxs("div",{className:"flex items-center justify-between text-base font-extrabold tracking-tight text-[rgb(var(--nefera-ink))]",children:[e.jsx("span",{children:t.label}),e.jsx("span",{className:"text-[rgb(var(--nefera-muted))]",children:t.value})]}),e.jsx("div",{className:"mt-3",children:e.jsx(H,{value:t.value,max:w})})]},t.label)):e.jsx("div",{className:"rounded-2xl border border-white/70 bg-white/55 p-6 text-sm text-[rgb(var(--nefera-muted))] shadow-lg shadow-black/5",children:"Do a few check-ins to see what shows up most often."}):e.jsx(e.Fragment,{children:Array.from({length:4}).map((t,s)=>e.jsxs("div",{className:"animate-pulse rounded-2xl border border-white/70 bg-white/55 p-6 shadow-lg shadow-black/5",children:[e.jsx("div",{className:"h-4 w-40 rounded-full bg-black/10"}),e.jsx("div",{className:"mt-3 h-2 w-full rounded-full bg-black/10"})]},s))})})]})]}),e.jsxs("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[e.jsxs(c,{children:[e.jsx(u,{emoji:"ðŸ§¾",title:"Submitted reports",subtitle:"Your submitted incident reports."}),e.jsxs(m,{className:"grid gap-2",children:[y.slice(0,10).map(t=>e.jsxs("div",{className:"rounded-2xl border border-[rgb(var(--nefera-border))] bg-white p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-extrabold text-[rgb(var(--nefera-ink))]",children:t.type}),e.jsx(M,{tone:t.status==="resolved"?"ok":t.status==="reviewing"?"warn":"neutral",children:t.status})]}),e.jsx("div",{className:"mt-1 text-xs font-semibold text-[rgb(var(--nefera-muted))]",children:O(t.createdAt)})]},t.id)),y.length===0?e.jsx("div",{className:"rounded-2xl border border-white/70 bg-white/60 p-4 text-sm text-[rgb(var(--nefera-muted))]",children:"No submitted reports yet."}):null]})]}),v]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(c,{children:[e.jsx(u,{emoji:"ðŸ”’",title:"Reports are unavailable",subtitle:"Your school has disabled reports right now."}),e.jsxs(m,{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("div",{className:"text-sm leading-6 text-[rgb(var(--nefera-muted))]",children:"You can still do a check-in, journal, or use other tools."}),e.jsx(D,{to:"/student/dashboard",children:e.jsx(p,{size:"sm",variant:"secondary",children:"Back"})})]})]}),v?e.jsx("div",{className:"mt-4",children:v}):null]})})}function q(){const{state:r,dispatch:j}=P(),{user:g}=z(),[h,y]=o.useState(""),[l,S]=o.useState(!0),[v,f]=o.useState({}),[N,x]=o.useState(!0),b=r.parent.children[0]?.id??r.teacher.students[0]?.id??"stu_1",I=r.teacher.students.find(s=>s.id===b)?.grade??r.parent.children.find(s=>s.id===b)?.grade??"",k=r.teacher.classes.find(s=>s.studentIds.includes(b))?.id??"",w=r.schoolConfig.openCircle.visibility,d=r.schoolConfig.features.openCircle&&w!=="off"&&(w==="school"?!0:w==="class"?r.schoolConfig.openCircle.allowedClassIds.length===0||r.schoolConfig.openCircle.allowedClassIds.includes(k):w==="grade"?r.schoolConfig.openCircle.allowedGrades.length===0||r.schoolConfig.openCircle.allowedGrades.includes(I):w==="groups"?r.schoolConfig.openCircle.allowedGroupIds.length===0||r.student.groups.some(s=>s.joined&&r.schoolConfig.openCircle.allowedGroupIds.includes(s.id)):!0);o.useEffect(()=>{const s=window.setTimeout(()=>x(!1),320);return()=>window.clearTimeout(s)},[]);const t=W("nefera_hint_open_circle_v1");return d?e.jsx(A,{emoji:"ðŸ«¶",title:"Open Circle",subtitle:"A friendly feed. Post anonymously or with your name.",children:e.jsxs("div",{className:"space-y-4",children:[t.show?e.jsxs(c,{children:[e.jsx(u,{emoji:"ðŸ’¡",title:"First time here?",subtitle:"Try a small share. Keep it kind. Anonymous is always okay."}),e.jsxs(m,{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("div",{className:"text-sm leading-6 text-[rgb(var(--nefera-muted))]",children:"If youâ€™re not ready to post, you can scroll and just read."}),e.jsx(p,{size:"sm",variant:"secondary",onClick:t.dismiss,children:"Okay"})]})]}):null,e.jsxs(c,{children:[e.jsx(u,{emoji:"ðŸ’¬",title:"Create post",subtitle:"Keep it kind. Be gentle with yourself and others."}),e.jsxs(m,{className:"space-y-4",children:[e.jsx(F,{value:h,onChange:s=>y(s.target.value),hint:"A small check-in counts. If youâ€™re sharing something sensitive, consider talking to a trusted adult too."}),e.jsx(B,{}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{selected:l,onClick:()=>S(!0),children:"Anonymous"}),e.jsx(L,{selected:!l,onClick:()=>S(!1),children:"Named"})]}),e.jsx(p,{disabled:!h.trim(),onClick:()=>{j({type:"student/addPost",post:{id:E("post"),createdAt:new Date().toISOString(),authorName:g?.name??"Student",anonymous:l,body:h.trim(),likes:[],comments:[]}}),y("")},children:"Post"})]})]})]}),e.jsxs("div",{className:"grid gap-4",children:[N?e.jsx(e.Fragment,{children:Array.from({length:2}).map((s,a)=>e.jsx(c,{children:e.jsxs(m,{className:"animate-pulse space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded-full bg-black/10"}),e.jsx("div",{className:"h-6 w-20 rounded-full bg-black/10"})]}),e.jsx("div",{className:"h-4 w-full rounded-full bg-black/10"}),e.jsx("div",{className:"h-4 w-5/6 rounded-full bg-black/10"}),e.jsx("div",{className:"h-9 w-32 rounded-2xl bg-black/10"})]})},`sk_${a}`))}):null,!N&&r.student.openCircle.length===0?e.jsxs(c,{children:[e.jsx(u,{emoji:"ðŸŒˆ",title:"No posts yet",subtitle:"Start the circle with something small and kind."}),e.jsxs(m,{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("div",{className:"text-sm leading-6 text-[rgb(var(--nefera-muted))]",children:"Share a win, ask for tips, or write what youâ€™re feeling. You can post anonymously."}),e.jsx(p,{onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},children:"Write the first post"})]})]}):null,r.student.openCircle.map(s=>e.jsx(c,{children:e.jsxs(m,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{className:"min-w-0",children:e.jsxs("div",{className:"text-sm font-extrabold text-[rgb(var(--nefera-ink))]",children:[s.anonymous?"Anonymous":s.authorName," ",e.jsx("span",{className:"ml-2 text-xs font-semibold text-[rgb(var(--nefera-muted))]",children:O(s.createdAt)})]})}),e.jsx(M,{children:s.anonymous?"ðŸ«¥ Anonymous":"ðŸ™‚ Named"})]}),e.jsx("div",{className:"text-sm text-[rgb(var(--nefera-ink))] whitespace-pre-wrap",children:s.body}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(p,{size:"sm",variant:"secondary",onClick:()=>j({type:"student/toggleLikePost",postId:s.id,userId:g?.id??"like_1"}),children:["â¤ï¸ ",s.likes.length]}),e.jsxs(M,{children:[s.comments.length," comments"]})]}),e.jsx(B,{}),e.jsxs("div",{className:"space-y-2",children:[s.comments.map(a=>e.jsxs("div",{className:"rounded-3xl border border-[rgb(var(--nefera-border))] bg-white p-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-[rgb(var(--nefera-muted))]",children:[a.authorName," â€¢ ",O(a.createdAt)]}),e.jsx("div",{className:"mt-1 text-sm text-[rgb(var(--nefera-ink))]",children:a.body})]},a.id)),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("textarea",{value:v[s.id]??"",onChange:a=>f(n=>({...n,[s.id]:a.target.value})),className:"min-h-11 flex-1 resize-none rounded-2xl border border-[rgb(var(--nefera-border))] bg-white px-4 py-3 text-sm outline-none ring-[rgba(98,110,255,0.22)] focus:ring-4"}),e.jsx(p,{size:"sm",disabled:!v[s.id]?.trim(),onClick:()=>{const a=(v[s.id]??"").trim();a&&(j({type:"student/addComment",postId:s.id,comment:{id:E("c"),createdAt:new Date().toISOString(),authorName:g?.name??"Student",body:a}}),f(n=>({...n,[s.id]:""})))},children:"Comment"})]})]})]})},s.id))]})]})}):e.jsx(A,{emoji:"ðŸ«¶",title:"Open Circle",subtitle:"A friendly feed. Post anonymously or with your name.",children:e.jsxs(c,{children:[e.jsx(u,{emoji:"ðŸ”’",title:"Open Circle is unavailable",subtitle:"Your school has limited access right now."}),e.jsxs(m,{className:"space-y-4",children:[e.jsx("div",{className:"text-sm leading-6 text-[rgb(var(--nefera-muted))]",children:"If you need support, try journaling, check in with a trusted adult, or send a message to school staff."}),e.jsx(D,{to:"/student/dashboard",children:e.jsx(p,{size:"sm",variant:"secondary",children:"Okay"})})]})]})})}export{q as StudentOpenCircle,K as StudentReports};
