import{u as v,j as t,P as f,C as c,c as d,e as u,S as g,B as b,b as N}from"./index-iislL19E.js";function j(r){return new Date(r).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function w(){const{state:r,dispatch:i}=v(),n=r.principal.reports,x=n.reduce((e,s)=>{const a=Date.parse(s.createdAt);return Number.isNaN(a)?e:Math.max(e,a)},0),m=1e3*60*60*24*7,o={};for(const e of n){const s=e.context?.classId;if(!s)continue;const a=Date.parse(e.createdAt);Number.isNaN(a)||x-a>m||(o[s]=(o[s]??0)+1)}function l(e){const s=/(self-harm|suicide|weapon|assault)/i.test(e.type)||/(immediate danger|kill|die|hurt myself)/i.test(e.description),a=e.context?.classId,h=a?(o[a]??0)>=3:!1;return s||h}const p=[...n].sort((e,s)=>{const a=Number(l(s))-Number(l(e));return a!==0?a:Date.parse(s.createdAt)-Date.parse(e.createdAt)});return t.jsx(f,{emoji:"ðŸ§¾",title:"Reports",subtitle:"Safety and wellbeing reports.",children:t.jsxs("div",{className:"grid gap-3",children:[p.map(e=>t.jsx(c,{children:t.jsxs(d,{className:"space-y-2",children:[t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[t.jsx("div",{className:"text-base font-extrabold tracking-tight text-[rgb(var(--nefera-ink))]",children:e.type}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[l(e)?t.jsx(u,{tone:"danger",children:"High priority"}):null,t.jsx(u,{tone:e.status==="resolved"?"ok":e.status==="reviewing"?"warn":"neutral",children:e.status})]})]}),t.jsx("div",{className:"text-xs font-semibold text-[rgb(var(--nefera-muted))]",children:j(e.createdAt)}),t.jsxs("div",{className:"text-xs font-semibold text-[rgb(var(--nefera-muted))]",children:[e.context?.school?`School: ${e.context.school}`:null,e.context?.className?`${e.context?.school?" â€¢ ":""}Class: ${e.context.className}`:null,e.context?.submittedBy?`${e.context?.school||e.context?.className?" â€¢ ":""}Submitted by: ${e.context.submittedBy}`:null]}),t.jsx("div",{className:"text-sm leading-6 text-[rgb(var(--nefera-muted))] whitespace-pre-wrap",children:e.description}),t.jsxs("div",{className:"text-xs font-semibold text-[rgb(var(--nefera-muted))]",children:["Anonymous: ",e.anonymous?"Yes":"No"]}),!e.anonymous&&e.context?.studentName?t.jsxs("div",{className:"text-xs font-semibold text-[rgb(var(--nefera-muted))]",children:["Student: ",e.context.studentName]}):null,t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 pt-1",children:[t.jsx("div",{className:"min-w-56",children:t.jsx(g,{value:e.status,onChange:s=>i({type:"reports/setStatus",reportId:e.id,status:s}),options:[{value:"received",label:"received"},{value:"reviewing",label:"reviewing"},{value:"resolved",label:"resolved"}]})}),t.jsx(b,{size:"sm",variant:"secondary",onClick:()=>i({type:"reports/setStatus",reportId:e.id,status:e.status==="resolved"?"reviewing":"resolved"}),children:e.status==="resolved"?"Re-open":"Mark resolved"})]})]})},e.id)),n.length===0?t.jsxs(c,{children:[t.jsx(N,{emoji:"ðŸŒ¿",title:"No reports yet",subtitle:"Reports will appear here as they are submitted."}),t.jsx(d,{className:"text-sm text-[rgb(var(--nefera-muted))]",children:"This page helps leadership review and route follow-up."})]}):null]})})}export{w as PrincipalReports};
